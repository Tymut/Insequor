# Definicje:
  # Choc keycaps = 17.5 x 16.5
  # cx = 18
  # cy = 17
  # MX keycaps = 18 x 18
  # U = 19.05
  # u = 19
  # Jednostki podawane są w milimetrach
points:
  key:
    padding: u
    footprints:
      choc_hotswap:
        type: choc
        nets:
          from: =column_net
          to: GND
        params:
          keycaps: true
          reverse: true
          hotswap: true
      mx_hotswap:
        type: mx
        anchor:
          rotate: 180
        nets:
          from: =column_net
          to: GND
        params:
          keycaps: true
          reverse: true
          hotswap: true
      diode:
        type: diode
        nets:
          from: =colrow
          to: =row_net
        anchor:
          shift: [0, -9]
  zones:
    matrix:
      key:
        tags:
          1u: true
      key.padding: u
      columns:
        outerpinkie:
          key:
            column_net: P21
        pinkie:
          key:
            column_net: P20
        ring:
          key:
            column_net: P19
          stagger: 7
        middle:
          key:
            column_net: P18
          stagger: 7
        index:
          key:
            column_net: P15
          stagger: -7
        far:
          key:
            column_net: P14
          stagger: -7
      rows:
        bottom:
          row_net: P6
        middle:
          row_net: P5
        home:
          row_net: P4
        top:
          row_net: P3
    thumbfan:
      anchor:
        ref: matrix_index_top
        shift: [-25,-85]
      columns:
        first:
          key:
            column_net: P20
          stagger: 8
        second:
          key:
            column_net: P19
        third:
          key:
            column_net: P18
          stagger: -7
        fourth:
          key:
            column_net: P15
          stagger: 4
          spread: 25
          rotate: -25
        fifth:
          key:
            column_net: P14
          rotate: -25
          stagger: -5
          spread: 22
      rows:
        bottom:
          row_net: P7
outlines:
  exports:
    raw_0:
      - type: keys
        side: left
        size: [18,18]
    promicro_rectangle:
      - type: rectangle
        size: [46, 80]
        anchor:
          ref: matrix_far_bottom
          shift: [0,-11]
    promicro_platecut:
      - type: rectangle
        size: [26, 57]
        anchor:
          ref: matrix_far_bottom
          shift: [12,10]
    topleftcorner_repair:
      - type: rectangle
        size: [20,20]
        anchor:
          ref: matrix_outerpinkie_top
          shift: [-17,-8]
    screw_holes:
      top_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_top
            shift: [9.5,-9.5]
        radius: 1.05
      bottom_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_bottom
            shift: [9.5,9.5]
        radius: 1.05
      bottom_right:
        type: circle
        anchor:
          - ref: matrix_far_bottom
            shift: [9.5,9.5]
        radius: 1.05
      top_right:
        type: circle
        anchor:
          - ref: matrix_far_top
            shift: [9.5,-9.5]
        radius: 1.05
      addon_outer:
        type: circle
        anchor:
          - ref: thumbfan_fourth_bottom
            shift: [13.5,9.5]
        radius: 1.05
    # TODO: Sprawdzić mounting_holes na 3mm
    mounting_holes:
      $extends: outlines.exports.screw_holes
      top_left:
        radius: 2.5
      bottom_left:
        radius: 2.5
      bottom_right:
        radius: 2.5
      top_right:
        radius: 2.5
      addon_outer:
        radius: 2.5
    raw:
      - type: keys
        side: left
        size: [1cx, 1cx]
      - type: outline
        name: promicro_rectangle
      - type: outline
        name: topleftcorner_repair
    switches_slots:
      main:
        type: keys
        side: left
        size: 14
        bound: false
    keycaps_choc:
      main:
        type: keys
        side: left
        size: [1cx - 0.5, 1cy - 0.5]
        bound: false
    keycaps_mx:
      main:
        type: keys
        side: left
        size: [18,18]
        bound: false
    circle_top:
      - type: circle
        radius: 154.68
        anchor:
          ref: matrix_middle_home
          shift: [5,-116]
      - type: rectangle
        size: [370,295.6]
        operation: subtract
        anchor:
          ref: matrix_middle_home
          shift: [-160,-278.6]
    frame:
      - type: polygon
        points:
          - ref: matrix_outerpinkie_top
            shift: [-17,12]
          - ref: matrix_outerpinkie_bottom
            shift: [-17,-17]
          - ref: matrix_pinkie_bottom
            shift: [0,-17]
          - ref: thumbfan_first_bottom
            shift: [-12,-17]
          - ref: thumbfan_second_bottom
            shift: [-2,-17]
          - ref: thumbfan_third_bottom
            shift: [-13,-17]
          - ref: thumbfan_third_bottom
            shift: [28,-17]
          - ref: thumbfan_fifth_bottom
            shift: [18,-17]
          - ref: thumbfan_fifth_bottom
            shift: [18,17]
          - ref: matrix_far_middle
            shift: [43,-25]
          - ref: matrix_far_top
            shift: [6,12]
    frame_fillet:
      - type: outline
        name: frame
        fillet: 7
    cutout:
      - type: outline
        name: raw
      - type: outline
        name: frame_fillet
        operation: add
      - type: outline
        name: circle_top
    plate:
      main:
        type: outline
        name: cutout
      switches:
        type: outline
        name: switches_slots
        operation: subtract
      cut:
        type: outline
        name: promicro_platecut
        operation: subtract
    plate_with_keycaps:
      main:
        type: outline
        name: cutout
      keycaps:
        type: keys
        side: left
        size: [18,18]
        operation: subtract
      cut:
        type: outline
        name: promicro_platecut
        operation: subtract
    pcb:
      main:
        type: outline
        name: cutout
      sockets:
        type: outline
        name: raw_0
        operation: subtract
      mounting_holes:
        type: outline
        name: mounting_holes
        operation: subtract
pcbs:
 # TODO: Dodać footprint enkodera
 # TODO: Dodać footprint oledu (kicad albo yaml)
 # TODO: Przystosować PCB do pracy wireless
  top_plate:
    outlines:
      matrix:
        outline: plate
        layer: Edge.Cuts
  insequor58:
    outlines:
      matrix:
        outline: cutout
      keycaps_mx:
        outline: keycaps_mx
        layer: Eco1.User
      keycaps_choc:
        outline: keycaps_choc
        layer: Eco2.User
      mounting_holes:
        outline: mounting_holes
    footprints:
      mcu_l:
        type: promicro
        params:
          orientation: up
        anchor:
          ref: matrix_far_top
          shift: [20,-8]
          rotate: 270
      mcu_r:
        type: promicro
        params:
          orientation: down
        anchor:
          ref: matrix_far_top
          shift: [22.5,-9.25]
          rotate: 270
      trrs_l:
        type: trrs
        nets:
          A: GND
          B: GND
          C: P2
          D: VCC
        anchor:
          ref: matrix_far_top
          shift: [38,8]
        params:
          reverse: false
          symmetric: true
      trrs_r:
        type: trrs
        nets:
          A: GND
          B: GND
          C: P2
          D: VCC
        anchor:
          ref: matrix_far_top
          shift: [38,8]
        params:
          reverse: true
          symmetric: true
      reset:
        type: button
        anchor:
          ref:
            - matrix_far_home
          shift: [35,9]
          rotate: 270
        params:
          variant: 2_pin_th
        nets:
          from: GND
          to: RST
      slider:
        type: slider
        anchor:
          ref: matrix_far_home
          shift: [35,2]
        nets:
          from: pos
          to: RAW
      via3:
        type: via
        anchor:
          ref: thumbfan_fourth_bottom
          shift: [15,5]
        nets:
          net: RAW
      via4:
        type: via
        anchor:
          ref: thumbfan_third_bottom
          shift: [15,5]
        nets:
          net: GND
      via5:
        type: via
        anchor:
          ref: matrix_index_bottom
          shift: [15,5]
        nets:
          net: pos
      via:
        type: via
        anchor:
          ref: matrix_far_home
          shift: [15,5]
        nets:
          net: RST
      bat_plus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [22.5,-9.25]
          rotate: 0
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B+"
        nets:
          net: Bplus
      bat_minus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [22.5,-6.25]
          rotate: 0
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B-"
        nets:
          net: GND
      jumper_l:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [38,-2]
          rotate: 270
        params:
          side: B
        nets:
          from: Bplus
          to: RAW
      jumper_r:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [38,-2]
          rotate: 270
        params:
          side: F
        nets:
          from: Bplus
          to: RAW
cases:
  plate:
    - type: outline
      name: plate
      extrude: 3
