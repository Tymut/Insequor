# Wykonał: Przemek Paciorek
# Na płytce zostały zdefiniowane komponenty pozwalające na pracę przewodową i bezprzewodową.
# Definicje:
  # Choc keycaps = 17.5 x 16.5
  # cx = 18
  # cy = 17
  # MX keycaps = 18 x 18
  # U = 19.05
  # u = 19
  # Jednostki podawane są w milimetrach
points:                 # points - określa pozycjonowanie slotów na switche
  key:
    padding: u
    footprints:
      choc_hotswap:
        type: choc
        anchor:
          rotate: 180
        nets:
          from: =column_net
          to: =row_net
        params:
          keycaps: true
          reverse: true
          hotswap: true
      mx_hotswap:
        type: mx
        nets:
          from: =row_net
          to: =column_net
        params:
          keycaps: true
          reverse: true
          hotswap: true
      diode:
        type: diode
        nets:
          from: =column_net
          to: =row_net
        anchor:
          shift: [0, -9]
  zones:
    matrix:
      key:
        tags:
          1u: true
      key.padding: u
      columns:
        outerpinkie:
          key:
            column_net: P21
        pinkie:
          key:
            column_net: P20
        ring:
          key:
            column_net: P19
          stagger: 7
        middle:
          key:
            column_net: P18
          stagger: 7
        index:
          key:
            column_net: P15
          stagger: -7
        far:
          key:
            column_net: P14
          stagger: -7
      rows:
        bottom:
          row_net: P7
        middle:
          row_net: P6
        home:
          row_net: P5
        top:
          row_net: P4
    thumbfan:
      anchor:
        ref: matrix_index_top
        shift: [-25,-85]
      columns:
        first:
          key:
            column_net: P21
          stagger: 8
        second:
          key:
            column_net: P20
        third:
          key:
            column_net: P19
          stagger: -7
        addon:
          key:
            column_net: P18
          stagger: 35
          spread: 25
        fourth:
          key:
            column_net: P15
          stagger: -30
          spread: 0
          rotate: -25
        fifth:
          key:
            column_net: P14
          rotate: -25
          stagger: -5
          spread: 22
      rows:
        bottom:
          row_net: P8
outlines:                 # outlines - określa krawędzie układu scalonegoo
  exports:
    raw_0:
      - type: keys
        side: left
        size: [18,18]
    promicro_rectangle:
      - type: rectangle
        size: [46, 80]
        anchor:
          ref: matrix_far_bottom
          shift: [0,-11]
    promicro_platecutOLD:
      - type: rectangle
        size: [26, 57]
        anchor:
          ref: matrix_far_bottom
          shift: [12,10]
    promicro_platecut:
      - type: rectangle
        size: [40, 60]
        anchor:
          ref: matrix_far_bottom
          shift: [10.5,25.5]
    topleftcorner_repair:
      - type: rectangle
        size: [20,20]
        anchor:
          ref: matrix_outerpinkie_top
          shift: [-17,-8]
    screw_holesTRAYMOUNT:
      top_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_top
            shift: [9.5,-9.5]
        radius: 2.7
      bottom_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_bottom
            shift: [9.5,9.5]
        radius: 2.7
      bottom_right:
        type: circle
        anchor:
          - ref: matrix_far_bottom
            shift: [8,9.5]
        radius: 2.7
      top_right:
        type: circle
        anchor:
          - ref: matrix_far_top
            shift: [8,-9.5]
        radius: 2.7
      addon_outer:
        type: circle
        anchor:
          - ref: thumbfan_fourth_bottom
            shift: [13.5,9.5]
        radius: 2.7
    mounting_holesTRAYMOUNT:
      $extends: outlines.exports.screw_holesTRAYMOUNT
      top_left:
        radius: 2.5
      bottom_left:
        radius: 2.5
      bottom_right:
        radius: 2.5
      top_right:
        radius: 2.5
      addon_outer:
        radius: 2.5
    screw_holesTOPMOUNT:
      top_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_top
            shift: [-12.5,9]
        radius: 3.25
      bottom_left:
        type: circle
        anchor:
          - ref: matrix_outerpinkie_bottom
            shift: [-12.5,-11]
        radius: 3.25
      bottom_leftMiddle:
        type: circle
        anchor:
          - ref: thumbfan_first_bottom
            shift: [-11,-12.5]
        radius: 3.25
      bottom_rightMiddle:
        type: circle
        anchor:
          - ref: thumbfan_third_bottom
            shift: [-11,-12.5]
        radius: 3.25
      bottom_right:
        type: circle
        anchor:
          - ref: thumbfan_fifth_bottom
            shift: [12.5,-11.5]
        radius: 3.25
      bottom_rightOuter:
        type: circle
        anchor:
          - ref: thumbfan_fifth_bottom
            shift: [12.5,11.5]
        radius: 3.25
      top_right:
        type: circle
        anchor:
          - ref: matrix_far_top
            shift: [42,-35]
        radius: 3.25
      top_rightMiddle:
        type: circle
        anchor:
          - ref: matrix_index_top
            shift: [0,21]
        radius: 3.25
      top_leftMiddle:
        type: circle
        anchor:
          - ref: matrix_ring_top
            shift: [10,21]
        radius: 3.25
    mounting_holesTOPMOUNT:
      $extends: outlines.exports.screw_holesTOPMOUNT
      top_left:
        radius: 2.5
      bottom_left:
        radius: 2.5
      bottom_leftMiddle:
        radius: 2.5
      bottom_rightMiddle:
        radius: 2.5
      bottom_right:
        radius: 2.5
      bottom_rightOuter:
        radius: 2.5
      top_right:
        radius: 2.5
      top_rightMiddle:
        radius: 2.5
      top_leftMiddle:
        radius: 2.5
    raw:
      - type: keys
        side: left
        size: [1cx, 1cx]
      - type: outline
        name: promicro_rectangle
      - type: outline
        name: topleftcorner_repair
    switches_slots:
      main:
        type: keys
        side: left
        size: 14.02
        bound: false
    keycaps_choc:
      main:
        type: keys
        side: left
        size: [1cx - 0.5, 1cy - 0.5]
        bound: false
    keycaps_mx:
      main:
        type: keys
        side: left
        size: [18,18]
        bound: false
    circle_top:
      - type: circle
        radius: 154.68
        anchor:
          ref: matrix_middle_home
          shift: [5,-116]
      - type: rectangle
        size: [370,295.6]
        operation: subtract
        anchor:
          ref: matrix_middle_home
          shift: [-160,-278.6]
    frame:
      - type: polygon
        points:
          - ref: matrix_outerpinkie_top
            shift: [-17,12]
          - ref: matrix_outerpinkie_bottom
            shift: [-17,-17]
          - ref: matrix_pinkie_bottom
            shift: [0,-17]
          - ref: thumbfan_first_bottom
            shift: [-12,-17]
          - ref: thumbfan_second_bottom
            shift: [-2,-17]
          - ref: thumbfan_third_bottom
            shift: [-13,-17]
          - ref: thumbfan_third_bottom
            shift: [29,-17]
          - ref: matrix_far_bottom
            shift: [46,-13]
          - ref: matrix_far_top
            shift: [46,12]
      - type: rectangle
        size: [30,36.5]
        anchor:
          ref: thumbfan_fifth_bottom
          shift: [-10,-18]
    frame_fillet:
      - type: outline
        name: frame
        fillet: 7
    cutout:
      - type: outline
        name: raw
      - type: outline
        name: frame_fillet
        operation: add
      - type: outline
        name: circle_top
    plate_TRAYMOUNT:
      main:
        type: outline
        name: cutout
      switches:
        type: outline
        name: switches_slots
        operation: subtract
      cut:
        type: outline
        name: promicro_platecut
        operation: subtract
      screw_holes:
        type: outline
        name: screw_holesTRAYMOUNT
        operation: subtract
    plate_TOPMOUNT:
      main:
        type: outline
        name: cutout
      switches:
        type: outline
        name: switches_slots
        operation: subtract
      cut:
        type: outline
        name: promicro_platecut
        operation: subtract
      screw_holes:
        type: outline
        name: screw_holesTOPMOUNT
        operation: subtract
    plate_with_keycaps:
      main:
        type: outline
        name: cutout
      keycaps:
        type: keys
        side: left
        size: [18,18]
        operation: subtract
      cut:
        type: outline
        name: promicro_platecut
        operation: subtract
    pcb_TRAYMOUNT:
      main:
        type: outline
        name: cutout
      sockets:
        type: outline
        name: raw_0
        operation: subtract
      mounting_holes:
        type: outline
        name: mounting_holesTRAYMOUNT
        operation: subtract
    pcb_TOPMOUNT:
      main:
        type: outline
        name: cutout
      sockets:
        type: outline
        name: raw_0
        operation: subtract
      mounting_holes:
        type: outline
        name: mounting_holesTOPMOUNT
        operation: subtract
    pcb_help:
      main:
        type: outline
        name: frame
      sockets:
        type: outline
        name: raw_0
        operation: subtract
      top:
        type: outline
        name: circle_top
pcbs:                 # pcbs - określa konfigurację która ma być przekonwertowana do programu KiCad
  sizing_help:
    outlines:
      top:
        outline: circle_top
      matrix:
        outline: frame
      keycaps_mx:
        outline: keycaps_mx
        layer: Eco1.User
      keycaps_choc:
        outline: keycaps_choc
        layer: Eco2.User
      mounting_holes:
        outline: mounting_holesTOPMOUNT
  plateTRAY:
    outlines:
      matrix:
        outline: plate_TRAYMOUNT
        layer: Edge.Cuts
  plateTOP:
    outlines:
      matrix:
        outline: plate_TOPMOUNT
        layer: Edge.Cuts
  moon60Tray:
    outlines:
      matrix:
        outline: cutout
      keycaps_mx:
        outline: keycaps_mx
        layer: Eco1.User
      keycaps_choc:
        outline: keycaps_choc
        layer: Eco2.User
      mounting_holes:
        outline: mounting_holesTRAYMOUNT
    footprints:
      mcu_l:
        type: promicro
        params:
          orientation: up
        anchor:
          ref: matrix_far_top
          shift: [20,-2]
          rotate: 270
      mcu_r:
        type: promicro
        params:
          orientation: down
        anchor:
          ref: matrix_far_top
          shift: [22.5,-3.25]
          rotate: 270
      trrs:
        type: trrs
        nets:
          A: GND
          B: GND
          C: P2
          D: VCC
        anchor:
          ref: matrix_far_top
          shift: [38,9]
        params:
          reverse: true
          symmetric: true
      reset:
        type: button
        anchor:
          ref:
            - matrix_far_home
          shift: [42,10]
          rotate: 270
        params:
          variant: 2_pin_th
        nets:
          from: GND
          to: RST
      slider:
        type: slider
        anchor:
          ref: matrix_far_home
          shift: [42,0.5]
          rotate: -90
        nets:
          from: pos
          to: RAW
      bat_plus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [21,-8.25]
          rotate: 90
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B+"
        nets:
          net: Bplus
      bat_minus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [24,-8.25]
          rotate: 90
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B-"
        nets:
          net: GND
      jumper_l:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [35,9]
          rotate: 270
        params:
          side: B
        nets:
          from: Bplus
          to: RAW
      jumper_r:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [35,9]
          rotate: 270
        params:
          side: F
        nets:
          from: Bplus
          to: RAW
  moon60Top:
    outlines:
      matrix:
        outline: cutout
      keycaps_mx:
        outline: keycaps_mx
        layer: Eco1.User
      keycaps_choc:
        outline: keycaps_choc
        layer: Eco2.User
      mounting_holes:
        outline: mounting_holesTOPMOUNT
    footprints:
      mcu_l:
        type: promicro
        params:
          orientation: up
        anchor:
          ref: matrix_far_top
          shift: [20,-2]
          rotate: 270
      mcu_r:
        type: promicro
        params:
          orientation: down
        anchor:
          ref: matrix_far_top
          shift: [22.5,-3.25]
          rotate: 270
      trrs:
        type: trrs
        nets:
          A: GND
          B: GND
          C: P2
          D: VCC
        anchor:
          ref: matrix_far_top
          shift: [38,9]
        params:
          reverse: true
          symmetric: true
      reset:
        type: button
        anchor:
          ref:
            - matrix_far_home
          shift: [42,10]
          rotate: 270
        params:
          variant: 2_pin_th
        nets:
          from: GND
          to: RST
      slider:
        type: slider
        anchor:
          ref: matrix_far_home
          shift: [42,0.5]
          rotate: -90
        nets:
          from: pos
          to: RAW
      bat_plus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [21,-8.25]
          rotate: 90
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B+"
        nets:
          net: Bplus
      bat_minus:
        type: pad
        anchor:
          ref: matrix_far_top
          shift: [24,-8.25]
          rotate: 90
        params:
          front: true
          back: true
          width: 1.5
          height: 1.5
          text: "B-"
        nets:
          net: GND
      jumper_l:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [35,9]
          rotate: 270
        params:
          side: B
        nets:
          from: Bplus
          to: RAW
      jumper_r:
        type: jumper
        anchor:
          ref: matrix_far_home
          shift: [35,9]
          rotate: 270
        params:
          side: F
        nets:
          from: Bplus
          to: RAW
cases:                 # cases - określa konfigurację plików .stl
  plateTRAY:
    - type: outline
      name: plate_TRAYMOUNT
      extrude: 1.5
  plateTOP:
    - type: outline
      name: plate_TOPMOUNT
      extrude: 1.5
